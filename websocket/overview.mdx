---
title: "WebSocket Overview"
description: "Real-time orderbook and trade streaming via WebSocket"
---

## Connection

```
wss://api.parsecapi.com/ws
```

## Authentication

Send an auth message immediately after connecting:

```json
{ "type": "auth", "api_key": "sk_your_api_key" }
```

On success:

```json
{ "type": "auth_ok", "customer_id": "cust_abc123" }
```

On failure:

```json
{ "type": "auth_error", "code": 1002, "message": "invalid api key" }
```

Authentication must complete within **15 seconds** or the connection is closed.

## Subscribing

After authentication, subscribe to markets:

```json
{
  "type": "subscribe",
  "markets": [
    { "parsec_id": "polymarket:0x1234abcd", "outcome": "Yes", "depth": 10 },
    { "parsec_id": "kalshi:KXBTC-25DEC-100K" }
  ]
}
```

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `parsec_id` | string | Yes | Market identifier (`{exchange}:{market_id}`) |
| `outcome` | string | No | `Yes` or `No` (case-insensitive, default: `Yes`) |
| `depth` | number | No | Price levels per side (default: 50, max depends on tier: Free=10, Pro=100) |

## Unsubscribing

```json
{
  "type": "unsubscribe",
  "markets": [{ "parsec_id": "polymarket:0x1234abcd", "outcome": "Yes" }]
}
```

## Resync

Request a fresh snapshot if data becomes stale:

```json
{ "type": "resync", "parsec_id": "polymarket:0x1234abcd", "outcome": "Yes" }
```

## Server Messages

### Orderbook

```json
{
  "type": "orderbook",
  "parsec_id": "polymarket:0x1234abcd",
  "exchange": "polymarket",
  "outcome": "Yes",
  "token_id": "217426...",
  "market_id": "0x1234abcd",
  "tick_size": 0.001,
  "kind": "snapshot",
  "bids": [[0.65, 1000.0], [0.64, 2500.0]],
  "asks": [[0.66, 800.0], [0.67, 1500.0]],
  "book_state": "fresh",
  "server_seq": 1234,
  "feed_state": "healthy",
  "stale_after_ms": 5000,
  "exchange_ts_ms": 1707044096000,
  "ingest_ts_ms": 1707044096005
}
```

### Orderbook Delta

Incremental orderbook updates are sent as `type: "orderbook_delta"`. Deltas use **absolute replacement** semantics:

- `size > 0`: set that price level to `size`
- `size == 0`: delete that price level

```json
{
  "type": "orderbook_delta",
  "parsec_id": "polymarket:0x1234abcd",
  "exchange": "polymarket",
  "outcome": "Yes",
  "token_id": "217426...",
  "market_id": "0x1234abcd",
  "changes": [
    { "side": "bid", "price": 0.65, "size": 900.0 },
    { "side": "ask", "price": 0.66, "size": 0.0 }
  ],
  "server_seq": 1234,
  "feed_state": "healthy",
  "book_state": "fresh",
  "stale_after_ms": 5000,
  "exchange_ts_ms": 1707044096100,
  "ingest_ts_ms": 1707044096105
}
```

### Activity (Trades & Fills)

Trades and fills are sent as `type: "activity"` with a `kind` field:

```json
{
  "type": "activity",
  "parsec_id": "polymarket:0x1234abcd",
  "exchange": "polymarket",
  "outcome": "Yes",
  "token_id": "217426...",
  "market_id": "0x1234abcd",
  "kind": "trade",
  "price": 0.65,
  "size": 100.0,
  "trade_id": "trade_123",
  "side": "buy",
  "aggressor_side": "buy",
  "server_seq": 1235,
  "feed_state": "healthy",
  "exchange_ts_ms": 1707044096100,
  "ingest_ts_ms": 1707044096105,
  "source_channel": "trades"
}
```

```json
{
  "type": "activity",
  "parsec_id": "kalshi:KXBTC-25DEC-100K",
  "exchange": "kalshi",
  "outcome": "Yes",
  "token_id": "",
  "market_id": "KXBTC-25DEC-100K",
  "kind": "fill",
  "price": 0.62,
  "size": 50.0,
  "fill_id": "fill_456",
  "order_id": "order_789",
  "side": "buy",
  "server_seq": 1236,
  "feed_state": "healthy",
  "exchange_ts_ms": 1707044096200,
  "ingest_ts_ms": 1707044096205,
  "source_channel": "user"
}
```

### Heartbeat

```json
{ "type": "heartbeat", "ts_ms": 1707044096000 }
```

### Error

```json
{ "type": "error", "code": 2001, "message": "invalid message", "parsec_id": "polymarket:0x1234abcd" }
```

`parsec_id` is included when the error relates to a specific market subscription. It is omitted for connection-level errors (e.g., authentication failures).

### Resync Required

Sent when you've fallen behind on updates:

```json
{ "type": "resync_required", "parsec_id": "polymarket:0x1234abcd", "outcome": "Yes" }
```

### Slow Reader

Warning that you're consuming messages too slowly:

```json
{ "type": "slow_reader", "parsec_id": "polymarket:0x1234abcd", "outcome": "Yes" }
```

## Book State

| State | Description |
|-------|-------------|
| `fresh` | Data is current and reliable |
| `stale` | No recent updates received |
| `needs_refresh` | Send a Resync message to get fresh data |

## Feed State

| State | Description |
|-------|-------------|
| `healthy` | Connected and receiving data normally |
| `degraded` | Partial connectivity or delayed data |
| `disconnected` | No connection to exchange |

## Sequence Numbers

Use `server_seq` to detect gaps. If you receive a sequence number more than 1 higher than the previous, send a Resync request to recover missed updates.

## Error Codes

| Code | Type | Description |
|------|------|-------------|
| 1001 | `auth_required` | Authentication required |
| 1002 | `auth_invalid` | Invalid API key |
| 2001 | `invalid_market` | Invalid message format or market ID |
| 2002 | `market_not_found` | Market does not exist |
| 2003 | `exchange_unavailable` | Exchange is unavailable |
| 2005 | `invalid_outcome` | Invalid outcome value |
| 3001 | `rate_limited` | Subscribe rate limit exceeded |
| 3002 | `max_subscriptions` | Max subscriptions reached |

## Limits

Limits depend on your API key tier:

| Limit | Free | Pro |
|-------|------|-----|
| Max subscriptions (total across connections) | 20 | 500 |
| Max orderbook depth (levels/side) | 10 | 100 |
| Subscribe rate limit | 3 req/sec | 3 req/sec |
| Authentication timeout | 15 sec | 15 sec |

When you exceed the subscription limit, the server responds with error code `3002`.
When you exceed the subscribe rate limit, the server responds with error code `3001`.

## Supported Exchanges

| Exchange | Orderbook | Trades | Fills |
|----------|-----------|--------|-------|
| Polymarket | Yes | Yes | Yes |
| Limitless | Yes | Yes | No |
| Kalshi | Yes | Yes | Yes |
| Opinion | Polling | No | No |
| Predict.fun | Polling | No | No |

## SDK Usage

The Parsec SDK handles authentication, reconnection, and message parsing automatically. This is the recommended way to consume the WebSocket API.

<CodeGroup>
```typescript TypeScript
import ParsecAPI from 'parsec-api';

const client = new ParsecAPI({ apiKey: 'pk_...' });
const ws = client.ws();

ws.on('orderbook', (book) => {
  console.log(`${book.parsecId} mid=${book.midPrice}`);
});

ws.on('activity', (trade) => {
  console.log(`Trade: ${trade.price} x ${trade.size}`);
});

ws.subscribe({ parsecId: 'polymarket:1234', outcome: 'yes' });
await ws.connect();
```

```python Python
from parsec_api import ParsecAPI
import asyncio

client = ParsecAPI(api_key="pk_...")
ws = client.ws()

@ws.on("orderbook")
async def on_book(book):
    print(f"{book.parsec_id} mid={book.mid_price}")

@ws.on("activity")
async def on_trade(trade):
    print(f"Trade: {trade.price} x {trade.size}")

async def main():
    ws.subscribe(parsec_id="polymarket:1234", outcome="yes")
    await ws.connect()
    await ws.run_forever()

asyncio.run(main())
```
</CodeGroup>

## Example: Raw JavaScript Client

If you need lower-level control, you can use the WebSocket API directly:

```javascript
const ws = new WebSocket('wss://api.parsecapi.com/ws');

ws.onopen = () => {
  ws.send(JSON.stringify({ type: 'auth', api_key: 'sk_your_api_key' }));
};

ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);

  switch (msg.type) {
    case 'auth_ok':
      console.log('Authenticated:', msg.customer_id);
      ws.send(JSON.stringify({
        type: 'subscribe',
        markets: [{ parsec_id: 'polymarket:0x1234', outcome: 'yes', depth: 10 }]
      }));
      break;

    case 'auth_error':
      console.error(`Auth failed (${msg.code}): ${msg.message}`);
      break;

    case 'orderbook':
      console.log(`Orderbook ${msg.parsec_id}:`, msg.bids[0], msg.asks[0]);
      break;

    case 'activity':
      console.log(`${msg.kind} ${msg.parsec_id}: ${msg.size} @ ${msg.price}`);
      break;

    case 'error':
      console.error(`Error ${msg.code}: ${msg.message}`);
      break;

    case 'resync_required':
      ws.send(JSON.stringify({
        type: 'resync',
        parsec_id: msg.parsec_id,
        outcome: msg.outcome
      }));
      break;
  }
};
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Get Orderbook" icon="book" href="/api/get-orderbook">
    Fetch orderbook snapshots via REST.
  </Card>
  <Card title="WebSocket Usage API" icon="chart-bar" href="/api/ws-usage">
    Monitor your WebSocket usage statistics.
  </Card>
</CardGroup>
